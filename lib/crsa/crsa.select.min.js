var CrsaSelect = function (t, e, i, l) {
    var a = this;
    this.$input = t, this.options = null, this.$val = e, this.val_dict = {};
    var s = {modal: !0, title: "Select an item", multiple: !1, "class": "rich-select"};
    this.opts = $.extend({}, s, l), this.setOptions = function (t) {
        this.val_dict = {};
        for (var e = 0; e < t.length; e++) {
            var i = t[e];
            this.val_dict[i.key] = i
        }
        this.options = t
    }, this.setOptions(i), this.getSelectedItem = function () {
        var t = this.$input.val(), e = null;
        return t && t in this.val_dict && (e = this.val_dict[t]), e
    }, this.paintVal = function () {
        var t = this.getSelectedItem();
        this.$val.html(""), t && this.$val.html(t.html)
    }, this.paintVal(), this.showSelect = function () {
        if (this.opts.modal) {
            for (var t = this.getSelectedItem(), e = null, i = $("<ul/>").addClass(l.class), s = 0; s < this.options.length; s++) {
                var n = this.options[s], h = $("<li/>").html(n.html).data("item", n).appendTo(i);
                t == n && (h.addClass("selected"), e = h)
            }
            var c = function () {
                a.getSelectedItem() != t && (t ? a.$input.val(t.key) : a.$input.val(""), a.paintVal(), a.$input.trigger("change"))
            }, o = makeModalDialog(this.opts.title, "Cancel", "Select", i, function () {
            }, function () {
                c()
            });
            i.find(">li").on("click", function (i) {
                var l = $(i.delegateTarget), a = l.data("item");
                e && (e.removeClass("selected"), e = null), t == a ? t = null : (t = a, e = l, l.addClass("selected")), c(), o.modal("hide"), i.preventDefault()
            })
        }
    }, e.on("click", function (t) {
        a.showSelect(), t.preventDefault()
    })
};