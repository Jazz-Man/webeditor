var CrsaUndoState = function (t, e) {
    var a = [];
    a.push({obj: t, data: t.sourceNode.toStringWithIds(!0, pinegrow.getFormatHtmlOptions())});
    for (var n = getCrsaPageStylesForPage(t.$iframe), o = 0; o < n.stylesheets.length; o++) {
        var r = n.stylesheets[o];
        r.inline || r.loaded && r.changed && a.push({obj: r, data: r.genGetSource()})
    }
    a.push({
        obj: "breakpoints",
        data: t.breakpoints.slice(0)
    }), this.page = t, this.data = a, this.name = e, this.active = !0;
    var i = this;
    this.apply = function (t) {
        for (var e = 0, a = null, n = 0; n < this.data.length; n++) {
            var o = this.data[n];
            "breakpoints" === o.obj ? a.obj.breakpoints = o.data : o.obj instanceof CrsaPage ? a = o : o.obj instanceof CrsaStylesheet && (e++, o.obj.changed = !0, o.obj.genSetSource(o.data, function () {
                if (e--, 0 == e) {
                    var n = new pgParser;
                    n.parse(a.data, function () {
                        a.obj.sourceNode = n.rootNode, t && t(i)
                    })
                }
            }, !0))
        }
        if (0 == e && a) {
            var r = new pgParser;
            r.parse(a.data, function () {
                a.obj.sourceNode = r.rootNode, t && t(i)
            })
        }
    }
}, CrsaPageUndoStack = function (t) {
    var e = [], a = -1, n = "undo";
    this.page = t, this.add = function (t, n) {
        var o = new CrsaUndoState(this.page, t);
        if (e.length > a + 1 && e.splice(a + 1, e.length - (a + 1)), e.push(o), !n) {
            a++;
            var r = 20;
            if (a > r) {
                var i = a - r;
                e.splice(0, i), a -= i
            }
        }
        return o
    }, this.isAtTheTip = function () {
        return a >= 0 && e.length == a + 1
    }, this.remove = function () {
        return 0 > a ? null : (a--, e.splice(a + 1, 1), void 0)
    }, this.undo = function (t) {
        var o = "undo" == n ? 0 : 1;
        if (0 + o > a)return t && t(null), null;
        "undo" != n && (a -= 1);
        var r = e[a];
        return a -= 1, r.apply(t), n = "undo", r
    }, this.redo = function (t) {
        var o = "undo" == n ? 2 : 1;
        if (a + o >= e.length)return t && t(null), null;
        a += o;
        var r = e[a];
        return r.apply(t), n = "redo", r
    }
}, CrsaUndo = function () {
};